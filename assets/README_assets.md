# Updating colormaps

## Contents

This folder contains the following scripts:

- `make_csvs_from_colorcet.m` - MATLAB/octave script to generate colormap CSVs, aliases, and CET name mapping
  from `colorcet.m`.
- `CET_merge.py` - Script to merge existing aliases and mapping variables with updates generated by
  `make_csvs_from_colorcet.m`.
- `CET_to_py.py` - Generate `colorcet/__init__.py` from the CSV colormaps, aliases, and mapping.

In addition, there are folders of CSV files containin the various colormaps.

## Update Process

1. If and when Peter Kovesi generates an updated `colorcet.m` using [his MATLAB
   scripts](https://www.peterkovesi.com/matlabfns/index.html#colour), download the most recent `colorcet.m`
   to this directory.
2. Prepare `make_csvs_from_colorcet.m`.
   1. Set `new_mapsdir` variable to a folder name for any new colormaps.
   2. Copy the `mapnames` variable from `colorcet.m` into `make_csvs_from_colorcet.m`.
3. Use Octave or MATLAB to run `make_csvs_from_colorcet.m`. This will:
   - Generate any new colormap CSV files in `new_mapsdir`.
   - Generate `CET_updates.py` with aliases and the CET name mapping based on `colorcet.m`.
4. Copy the current existing `aliases` and `mapping` variables from `CET_to_py.py` to the marked place in
   `CET_merge.py` and run `python CET_merge.py` to generate merged `aliases` and `mapping` variables.
   - `CET_merge.py` ensures that no aliases point to more than one colormap descriptorname (_terminology from
     `colorcet.m`_)
   - `CET_merge.py` ensures that existing alias assingments take precedence over any new alias assignments
     from `colorcet.m` to make sure that the aliases from this library consistently point to the same maps.
     This may mean some divergence from `colorcet.m`.
5. Update `CET_to_py.py`.
   1. Copy the new merged `aliases` and `mapping` variables (from terminal output) into `CET_to_py.py` to
      replace the existing variables. \[Restore `# mpl` comments back to `aliases`\]
   2. If new colormap CSVs have been generated in \<`new_mapsdir`\>, add that folder to the `paths` variable.
6. Run `python CET_to_py.py` to generate a new `colorcet/__init__.py`.
7. From the main directory, run `pytest` and adjust the colormap counts in the various test scripts to get
   the tests to pass correctly.
